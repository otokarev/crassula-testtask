# crassula-testtask

# Задание
```text
Нужно прочитать наше стандартное тестовое задание, но вместо непосредственно реализации, нужно описать подход к реализации:

Предположим, что уже есть команда Symfony, которая должна обновлять курсы раз в сутки, и есть controller action, который принимает request в каком-то виде, и в каком-то виде отдаёт response.
Как бы вы реализовали описанную функциональность, как бы хранили данные, какие классы бы использовали (repositories, services, DTO, value objects etc.), и как бы их назвали.

Вот само задание

1. Создайте репозитарий (на ГитХабе, например, или БитБакете), в который будете складывать код.

Используя экспорт из двух источников реализуйте сбор данных о курсах валют на текущую дату посредством консольной команды
https://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml
https://www.cbr.ru/scripts/XML_daily.asp

Все данные нужно записать в БД используя ORM Doctrine
Сделать конфигурацию в проекте для переключения источника данных (ECB или CBR). Уметь рассчитывать сумму для обмена между валютами, которые не являются базовыми валютами используемых центробанков (к примеру, USD-GBP).
Написать REST сервис где можно указать сумму и связку валют и получить в ответ сконвертированую сумму
Написать интеграционные и юнит тесты
Пришлите ссылку на репозитарий и укажите общее время, затраченное на задание.
Задание необходимо выполнить на фрэймворке Symfony последней версии
Постарайтесь как можно полнее показать ваши знания и умения проектирования и написания кода.

Это наше тех задание
```

# Реализация
**Declaimer**: Поскольку задача была только описать реализацию, приложение в вашем случае может не запуститься. Не реализованы все возможные тесты, валидация входных параметров и пр.

Реализация модели лежит в директории `src/Model`

Реализация прикладного и инфраструктурного уровня расположены в стандартных папках Symfony.

## Импорт данных из внешних источников
Реализацию модели можно посмотреть в директории `src/Model/RateHistoryFetcher`

Клиентский код: `src/Command/FetchRatesCommand.php`

Переключение адаптеров ECB<->CBR производится сменой значения
```yaml
services:
    App\Model\RateHistoryFetcher\RateHistoryRecordFetcher: '@ecb_rates_fetcher'
```

## Конвертация одной валюты в другую
Реализацию модели можно посмотреть в директории `src/Model/MoneyConvertor`

Клиентский код: `src/Controller/ConvertController.php`

## Запуск  приложения

Собрать Docker-образы
```shell
docker-compose -f docker-compose.yml -f docker-compose.debug.yml -f docker-compose.override.yml build
```
Запустить
```shell
XDEBUG_CLIENT_HOST=172.18.0.1  docker-compose -f docker-compose.yml -f docker-compose.debug.yml -f docker-compose.override.yml up
```

Сервис будет доступен в браузере по адресу `https://localhost/convert/USD/RUB/1`
Здесь:
* `USD` - валюта, из которой конвертировать
* `RUB` - валюта, в которую конвертировать
* `1` - сумма, в данном примере это 1$

